<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Streaming</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            background-attachment: fixed;
            height: 100%;
            color: #fff;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Animated gradient background */
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Floating particles effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Watermark Sphere with Headphones */
        .watermark-sphere {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            pointer-events: none;
            z-index: 1;
            opacity: 0.41;
            animation: breathingEffect 6s ease-in-out infinite;
        }

        @keyframes breathingEffect {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.15);
            }
        }

        .sphere-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Fixed Headphones Icon (Behind Sphere) */
        .headphones-icon {
            position: absolute;
            top: 34%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 260px;
            color: rgba(255, 255, 255, 0.3);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            z-index: 1;
        }

        /* Rotating Sphere (Earth-like) - Front Layer */
        .sphere {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.94) 50%, rgba(255, 255, 255, 0.03));
            box-shadow:
                inset -15px -15px 30px rgba(0, 0, 0, 0.2),
                inset 15px 15px 30px rgba(255, 255, 255, 0.15),
                0 0 25px rgba(255, 255, 255, 0.2),
                0 0 50px rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
            z-index: 2;
        }

        /* Sphere texture lines (rotating left to right) */
        .sphere::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 300%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 12px,
                rgba(255, 255, 255, 0.08) 12px,
                rgba(255, 255, 255, 0.08) 14px
            );
            animation: sphereTexture 20s linear infinite;
        }

        /* Horizontal latitude lines */
        .sphere::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 18px,
                rgba(255, 255, 255, 0.05) 18px,
                rgba(255, 255, 255, 0.05) 20px
            );
            border-radius: 50%;
        }

        @keyframes sphereRotateY {
            0% {
                transform: translate(-50%, -50%) rotateY(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotateY(360deg);
            }
        }

        @keyframes sphereTexture {
            0% {
                left: -100%;
            }
            100% {
                left: 0%;
            }
        }

        @keyframes sphereGlow {
            0%, 100% {
                box-shadow:
                    inset -15px -15px 30px rgba(0, 0, 0, 0.2),
                    inset 15px 15px 30px rgba(255, 255, 255, 0.15),
                    0 0 25px rgba(255, 255, 255, 0.25),
                    0 0 50px rgba(255, 255, 255, 0.2);
            }
            50% {
                box-shadow:
                    inset -15px -15px 30px rgba(0, 0, 0, 0.2),
                    inset 15px 15px 30px rgba(255, 255, 255, 0.2),
                    0 0 35px rgba(255, 255, 255, 0.4),
                    0 0 70px rgba(255, 255, 255, 0.3);
            }
        }

        /* Responsive watermark */
        @media (max-width: 1024px) {
            .watermark-sphere {
                width: 240px;
                height: 240px;
            }

            .sphere {
                width: 150px;
                height: 150px;
            }

            .headphones-icon {
                font-size: 260px;
            }
        }

        @media (max-width: 768px) {
            .watermark-sphere {
                width: 200px;
                height: 200px;
            }

            .sphere {
                width: 120px;
                height: 120px;
            }

            .headphones-icon {
                font-size: 165px;
            }
        }

        /* Thin Scrollbar Styles */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        *::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        *::-webkit-scrollbar-track {
            background: transparent;
        }

        *::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Header - Sticky at top */
        .header {
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(30px) saturate(180%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            position: relative;
        }

        /* Logo */
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            text-decoration: none;
            position: relative;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.2));
            border-radius: 50%;
            font-size: 1.4rem;
            animation: logoGlow 4s ease-in-out infinite;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.5),
                        0 0 50px rgba(255, 255, 255, 0.3);
            position: relative;
        }

        @keyframes logoGlow {
            0%, 100% {
                box-shadow: 0 0 25px rgba(255, 255, 255, 0.5),
                            0 0 50px rgba(255, 255, 255, 0.3),
                            0 0 75px rgba(255, 255, 255, 0.2),
                            inset 0 0 20px rgba(255, 255, 255, 0.3);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 255, 255, 0.8),
                            0 0 80px rgba(255, 255, 255, 0.6),
                            0 0 120px rgba(255, 255, 255, 0.4),
                            inset 0 0 30px rgba(255, 255, 255, 0.5);
                transform: scale(1.08);
            }
        }

        .logo-icon i {
            animation: iconPulse 4s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% {
                opacity: 0.9;
            }
            50% {
                opacity: 1;
            }
        }

        .logo-text {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, rgba(255, 255, 255, 0.8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: flex-end;
        }

        /* Main Container */
        .container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            padding-bottom: 160px; /* Space for fixed player */
            min-height: 0;
        }

        .content-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            height: 100%;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tab {
            background: rgba(255, 255, 255, 0.18);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 22px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.28);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .tab.active {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.3));
            color: #fff;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .tab i {
            font-size: 0.85rem;
        }

        /* Content */
        .content {
            display: none;
        }

        .content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* Search Bar */
        .search-container {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 50px;
            padding: 6px 22px;
            border: 1px solid rgba(255, 255, 255, 0.35);
            display: flex;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(31, 38, 135, 0.1);
            flex: 1;
            max-width: 500px;
            min-width: 200px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-container:focus-within {
            background: rgba(255, 255, 255, 0.28);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 6px 25px rgba(31, 38, 135, 0.2);
            transform: translateY(-2px);
        }

        .search-container input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 0.95rem;
            outline: none;
            min-width: 0;
            font-weight: 400;
        }

        .search-container input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-container button {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2));
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 10px 22px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 0.85rem;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .search-container button:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.3));
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .search-container button:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.02);
        }

        .search-container button i {
            font-size: 0.85rem;
        }

        /* Settings Icon */
        .settings-icon {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.35);
            border-radius: 50%;
            width: 46px;
            height: 46px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            color: #fff;
            font-size: 1.15rem;
            box-shadow: 0 4px 15px rgba(31, 38, 135, 0.1);
            position: relative;
            overflow: hidden;
        }

        .settings-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }

        .settings-icon:hover::before {
            width: 100px;
            height: 100px;
        }

        .settings-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 6px 25px rgba(31, 38, 135, 0.2);
        }

        /* Dialog Overlay */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0);
            backdrop-filter: blur(0px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        visibility 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        background 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        backdrop-filter 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dialog-overlay.active {
            opacity: 1;
            visibility: visible;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        /* Dialog Container */
        .dialog {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.8) translateY(-30px);
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dialog-overlay.active .dialog {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        /* Dialog Header */
        .dialog-header {
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dialog-header h2 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dialog-header h2 i {
            color: rgba(255, 255, 255, 0.8);
        }

        .dialog-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1.1rem;
        }

        .dialog-close:hover {
            background: rgba(255, 100, 100, 0.3);
            transform: rotate(90deg);
        }

        /* Dialog Body */
        .dialog-body {
            padding: 24px;
            max-height: calc(80vh - 80px);
            overflow-y: auto;
        }

        /* Settings Section */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .settings-option {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .settings-option:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .settings-option:last-child {
            margin-bottom: 0;
        }

        .settings-option-label {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-option-label i {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .settings-option-description {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 12px;
        }

        /* View Toggle in Settings */
        .view-toggle {
            display: flex;
            gap: 8px;
        }

        .view-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }

        .view-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .view-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: rgba(255, 255, 255, 0.3);
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .view-btn i {
            font-size: 1rem;
        }

        /* List View */
        .songs-list {
            display: none;
        }

        .songs-list.active {
            display: block;
        }

        .song-item {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
        }

        .song-item:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: translateX(4px);
        }

        .song-item img {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
        }

        .song-item-info {
            flex: 1;
            min-width: 0;
        }

        .song-item-title {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .song-item-artist {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .song-item-duration {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .song-item-play {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .song-item-play:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .song-item-play i {
            margin-left: 2px;
        }

        /* Grid View */
        .songs-grid {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .songs-grid.active {
            display: grid;
        }

        #playlistsGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .card {
            background: rgba(255, 255, 255, 0.18);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 20px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.25);
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 12px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .card:hover img {
            transform: scale(1.05);
        }

        .card h3 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn i {
            font-size: 0.85rem;
        }

        /* Player - Sticky at bottom with expandable panel */
        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(102, 126, 234, 0.41);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 230px;
            overflow: hidden;
        }

        .player.expanded {
            max-height: 90%;
            overflow-y: auto;
        }

        .player-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 20px;
            position: relative;
        }

        /* Expand/Collapse Button */
        .expand-btn {
            position: absolute;
            top: -13px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            width: 98px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: white;
            font-size: 0.9rem;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            pointer-events: none;
            z-index: 1001;
        }

        .player.has-song .expand-btn {
            opacity: 1;
            pointer-events: all;
        }

        .expand-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .expand-btn i {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .player.expanded .expand-btn i {
            transform: rotate(180deg);
        }

        /* Video Details Panel */
        .video-details-panel {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .player.expanded .video-details-panel {
            opacity: 1;
            max-height: none;
        }

        .details-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .details-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .details-section h3 i {
            color: rgba(255, 255, 255, 0.7);
        }

        .video-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .stat-item i {
            color: rgba(255, 255, 255, 0.8);
        }

        .video-description {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9rem;
        }

        /* Comments Section */
        .comments-container {
            max-height: 500px;
            overflow-y: auto;
        }

        .comment {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 3px solid rgba(255, 255, 255, 0.2);
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .comment-author {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .comment-date {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-left: auto;
        }

        .comment-text {
            margin-bottom: 8px;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .comment-footer {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .comment-likes {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .comment-replies {
            margin-left: 30px;
            margin-top: 10px;
        }

        .comment-reply {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 2px solid rgba(255, 255, 255, 0.15);
        }

        .loading-spinner {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
        }

        .loading-spinner i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            color: #fff;
        }


        /* CD Player Animation */
        .cd-player {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
        }

        .cd-disc {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            position: relative;
            animation: rotate 20s linear infinite;
            animation-play-state: paused;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 0 40px rgba(0, 0, 0, 0.3);
        }

        .cd-disc.playing {
            animation-play-state: running;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .cd-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 140px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.1);
        }

        .cd-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cd-hole {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a1a2e, #0f0f1e);
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8);
        }

        /* Song Info */
        .song-info {
            flex: 1;
            min-width: 150px;
        }

        .song-info h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .song-info p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Player Controls */
        .player-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 2;
            min-width: 280px;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn.play-pause {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            font-size: 1rem;
            border: none;
        }

        .control-btn.play-pause:hover {
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .control-btn i {
            pointer-events: none;
        }

        .control-btn.play-pause i {
            margin-left: 2px;
        }

        /* Progress Bar */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .time {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            min-width: 38px;
            font-variant-numeric: tabular-nums;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            transition: height 0.2s ease;
        }

        .progress-bar:hover {
            height: 8px;
        }

        /* Buffered progress (light gray) - shows loaded portion */
        .buffered-progress {
            position: absolute;
            height: 100%;
            background: rgba(255, 255, 255, 0.4);
            width: 0%;
            transition: width 0.3s ease;
            z-index: 1;
        }

        /* Current playback progress (gradient) */
        .progress {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.1s linear;
            z-index: 2;
        }

        /* Seek handle (appears on hover) */
        .progress::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .progress-bar:hover .progress::after {
            opacity: 1;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 30, 50, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 460px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px;
            color: #fff;
            font-size: 0.95rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .loading-spinner {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .loading-spinner i {
            font-size: 1.5rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .end-of-results {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .header-top {
                flex-direction: row;
                align-items: stretch;
            }

            .header-left {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .logo {
                font-size: 1.3rem;
            }

            .logo-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .logo-text {
                display: none;
            }

            .tabs {
                justify-content: center;
                width: 100%;
            }

            .header-right {
                flex-direction: row;
                align-items: center;
                gap: 10px;
                width: 70%;
            }

            .search-container {
                flex: 1;
                max-width: 100%;
            }

            .view-toggle {
                justify-content: center;
            }

            .songs-grid,
            #playlistsGrid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }

            .container {
                padding: 15px;
            }

            .logo {
                font-size: 1.1rem;
            }

            .logo-icon {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }

            .logo-text {
                font-size: 1.1rem;
            }

            .tabs {
                gap: 6px;
                display: none;
            }

            .tab {
                padding: 6px 14px;
                font-size: 0.85rem;
            }

            .search-container {
                padding: 4px 15px;
            }

            .search-container input {
                font-size: 0.85rem;
            }

            .search-container button {
                padding: 6px 16px;
                font-size: 0.8rem;
            }

            .settings-icon {
                width: 38px;
                height: 38px;
                font-size: 1rem;
            }

            .dialog {
                width: 95%;
                max-width: 95%;
            }

            .dialog-header {
                padding: 16px 18px;
            }

            .dialog-header h2 {
                font-size: 1.1rem;
            }

            .dialog-body {
                padding: 18px;
            }

            .settings-option {
                padding: 12px;
            }

            .view-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }

            .songs-grid,
            #playlistsGrid {
                gap: 12px;
            }

            .card {
                padding: 12px;
            }

            .card img {
                height: 140px;
            }

            .song-item {
                padding: 10px;
                gap: 10px;
            }

            .song-item img {
                width: 45px;
                height: 45px;
            }

            .song-item-title {
                font-size: 0.9rem;
            }

            .song-item-artist {
                font-size: 0.75rem;
            }

            .song-item-duration {
                font-size: 0.75rem;
            }

            .song-item-play {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }

            /* Player responsive */
            .player {
                max-height: 160px;
            }

            .player-content {
                flex-wrap: wrap;
                gap: 12px;
                padding: 10px 15px;
            }

            .expand-btn {
                width: 63px;
                height: 32px;
                font-size: 1rem;
                top: -19px;
            }

            .video-details-panel {
                padding: 15px;
            }

            .details-section {
                padding: 15px;
            }

            .video-stats {
                gap: 10px;
            }

            .stat-item {
                font-size: 0.8rem;
                padding: 6px 12px;
            }

            .comment-avatar {
                width: 32px !important;
                height: 32px !important;
            }

            .cd-disc {
                width: 120px;
                height: 120px;
            }

            .cd-center {
                width: 85px;
                height: 85px;
            }

            .cd-hole {
                width: 30px;
                height: 30px;
            }

            .song-info {
                flex: 1;
                min-width: 120px;
            }

            .song-info h3 {
                font-size: 0.85rem;
            }

            .song-info p {
                font-size: 0.7rem;
            }

            .player-controls {
                width: 100%;
                min-width: auto;
            }

            .control-buttons {
                gap: 6px;
            }

            .control-btn {
                width: 32px;
                height: 32px;
                font-size: 0.8rem;
            }

            .control-btn.play-pause {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .time {
                font-size: 0.65rem;
                min-width: 35px;
            }

            /* Mobile - Larger touch target for progress bar */
            .progress-bar {
                height: 8px !important;
                touch-action: none; /* Prevent scrolling while dragging */
            }

            .progress-bar:active {
                height: 12px !important;
            }

            /* Mobile - Always show seek handle for better visibility */
            .progress::after {
                opacity: 0.7 !important;
                width: 14px !important;
                height: 14px !important;
            }

            .progress-bar:active .progress::after {
                opacity: 1 !important;
                width: 16px !important;
                height: 16px !important;
            }

            /* Mobile - Better buffered bar visibility */
            .buffered-progress {
                background: rgba(255, 255, 255, 0.5) !important;
            }

            .modal-content {
                padding: 20px;
                max-width: 90%;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                gap: 8px;
            }

            .tabs {
                gap: 4px;
            }

            .tab {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            .view-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .cd-disc {
                width: 80px;
                height: 80px;
            }

            .cd-center {
                width: 55px;
                height: 55px;
            }

            .cd-hole {
                width: 20px;
                height: 20px;
            }

            .control-btn {
                width: 28px;
                height: 28px;
                font-size: 0.75rem;
            }

            .control-btn.play-pause {
                width: 36px;
                height: 36px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <!-- Watermark Sphere -->
    <div class="watermark-sphere">
        <div class="sphere-container">
            <i class="fas fa-headphones headphones-icon"></i>
            <div class="sphere"></div>
        </div>
    </div>

    <!-- Sticky Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-top">
                <div class="header-left">
                    <a href="#" class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <span class="logo-text">YT Music</span>
                    </a>
                    <div class="tabs">
                        <div class="tab active" data-tab="songs"><i class="fas fa-music"></i> Songs</div>
                        <div class="tab" data-tab="playlists"><i class="fas fa-list-ul"></i> Playlists</div>
                        <div class="tab" data-tab="history"><i class="fas fa-history"></i> History</div>
                        <div class="tab" data-tab="user"><i class="fas fa-user"></i> Account</div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="Search for songs, artists, albums..." />
                        <button onclick="searchSongs()"><i class="fas fa-search"></i> </button>
                    </div>
                    <div class="settings-icon" onclick="openSettingsDialog()">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="container">
        <div class="content-wrapper">
            <!-- Songs Tab -->
            <div class="content active" id="songs">
                <div class="songs-list active" id="songsList"></div>
                <div class="songs-grid" id="songsGrid"></div>
            </div>

            <!-- Playlists Tab -->
            <div class="content" id="playlists">
                <button class="btn btn-primary" onclick="showCreatePlaylistModal()" style="margin-bottom: 20px;">
                    <i class="fas fa-plus"></i> Create Playlist
                </button>
                <div id="playlistsGrid"></div>
            </div>

            <!-- History Tab -->
            <div class="content" id="history">
                <div id="historyList"></div>
            </div>

            <!-- User/Login Tab -->
            <div class="content" id="user">
                <div id="loginSection">
                    <div class="card" style="max-width: 400px; margin: 0 auto;">
                        <h2 style="margin-bottom: 20px;">Login</h2>
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="loginUsername" />
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" />
                        </div>
                        <button class="btn btn-primary" onclick="login()" style="width: 100%;">Login</button>
                        <p style="margin-top: 15px; text-align: center; color: rgba(255,255,255,0.7); font-size: 0.85rem;">
                            Don't have an account? <a href="#" onclick="showSignup()"
                                style="color: #a8b8ff; text-decoration: none;">Sign up</a>
                        </p>
                    </div>
                </div>
                <div id="userInfo" style="display: none;">
                    <div class="card" style="max-width: 400px; margin: 0 auto;">
                        <h2 style="margin-bottom: 20px;">Account Info</h2>
                        <p style="margin-bottom: 10px;"><strong>Username:</strong> <span id="userUsername"></span></p>
                        <p style="margin-bottom: 20px;"><strong>Email:</strong> <span id="userEmail"></span></p>
                        <button class="btn" onclick="logout()" style="width: 100%;">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sticky Music Player with Expandable Details -->
    <div class="player" id="musicPlayer">
        <audio id="audioPlayer" preload="auto"></audio>

        <!-- Expand/Collapse Button -->
        <button class="expand-btn" onclick="togglePlayerExpand()" title="Click to view video details, comments & more">
            <i class="fas fa-chevron-down"></i>
        </button>

        <div class="player-content">
            <div class="cd-disc" id="albumDisk">
                <div class="cd-center">
                    <img id="albumArt" src="https://via.placeholder.com/140?text=" class="cd-thumbnail"
                        id="cdThumbnail" alt="Album Art">
                </div>
                <div class="cd-hole"></div>
            </div>

            <div class="song-info">
                <h3 id="currentSongTitle">No song playing</h3>
                <p id="currentSongArtist">Select a song to play</p>
            </div>

            <div class="player-controls">
                <div class="control-buttons">
                    <button class="control-btn" onclick="previousSong()" title="Previous"><i class="fas fa-step-backward"></i></button>
                    <button class="control-btn play-pause" onclick="togglePlay()" id="playPauseBtn"
                        title="Play/Pause"><i class="fas fa-play"></i></button>
                    <button class="control-btn" onclick="stopSong()" title="Stop"><i class="fas fa-stop"></i></button>
                    <button class="control-btn" onclick="nextSong()" title="Next"><i class="fas fa-step-forward"></i></button>
                    <button class="control-btn" onclick="toggleShuffle()" id="shuffleBtn" style="opacity: 0.5;"
                        title="Shuffle"><i class="fas fa-random"></i></button>
                </div>

                <div class="progress-container">
                    <span class="time" id="currentTime">0:00</span>
                    <div class="progress-bar">
                        <div class="buffered-progress" id="bufferedBar"></div>
                        <div class="progress" id="progressBar"></div>
                    </div>
                    <span class="time" id="duration">0:00</span>
                </div>
            </div>
        </div>

        <!-- Video Details Panel (Expandable) -->
        <div class="video-details-panel" id="videoDetailsPanel">
            <div id="videoDetailsContent">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Create Playlist Modal -->
    <div class="modal" id="createPlaylistModal">
        <div class="modal-content">
            <h2>Create Playlist</h2>
            <div class="form-group">
                <label>Playlist Name</label>
                <input type="text" id="playlistName" placeholder="My Playlist" />
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="playlistDescription" placeholder="Optional description..."></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="createPlaylist()" style="flex: 1;">Create</button>
                <button class="btn" onclick="closeModal()" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://music-app-920748930700.europe-west1.run.app/api/v1';
        let token = localStorage.getItem('token');
        let currentPlaylist = [];
        let currentSongIndex = -1;
        let isPlaying = false;
        let isShuffle = false;
        let currentView = 'list';

        // Infinite Scroll State
        let currentSearchQuery = '';
        let currentContinuation = null;
        let isLoadingMore = false;
        let hasMoreResults = true;
        const SONGS_PER_PAGE = 20;

        // Video Details State
        let isPlayerExpanded = false;
        let currentVideoId = null;
        let videoDetailsCache = {};

        // Tab Navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');

                if (tab.dataset.tab === 'playlists') loadPlaylists();
                if (tab.dataset.tab === 'history') loadHistory();
                if (tab.dataset.tab === 'user') checkAuth();
            });
        });

        // View Toggle
        function setView(view) {
            currentView = view;

            // Update all view buttons (both in dialog and any other locations)
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to clicked button and corresponding button in dialog
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Also update the other set of buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                const btnText = btn.textContent.toLowerCase();
                if ((view === 'list' && btnText.includes('list')) ||
                    (view === 'grid' && btnText.includes('grid'))) {
                    btn.classList.add('active');
                }
            });

            const listView = document.getElementById('songsList');
            const gridView = document.getElementById('songsGrid');

            if (view === 'list') {
                listView.classList.add('active');
                gridView.classList.remove('active');
            } else {
                listView.classList.remove('active');
                gridView.classList.add('active');
            }

            // Scroll to top when switching views
            document.querySelector('.container').scrollTop = 0;

            // Close settings dialog after selection
            setTimeout(() => {
                closeSettingsDialog();
            }, 300);
        }

        // Search Songs
        async function searchSongs() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            // Reset state for new search
            currentSearchQuery = query;
            currentContinuation = null;
            hasMoreResults = true;
            isLoadingMore = false;

            const listContainer = document.getElementById('songsList');
            const gridContainer = document.getElementById('songsGrid');

            listContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Searching...</div>';
            gridContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Searching...</div>';

            try {
                // Fetch initial results with pagination support
                const response = await fetch(`${API_BASE}/music/search?query=${encodeURIComponent(query)}&limit=${SONGS_PER_PAGE}`);
                const data = await response.json();

                const songs = data.results || data; // Handle both old and new response format
                currentContinuation = data.continuation || null;
                currentPlaylist = songs;

                console.log('Search completed:', {
                    resultsCount: songs.length,
                    hasContinuation: !!currentContinuation,
                    continuationToken: currentContinuation ? 'Available' : 'None'
                });

                // Clear containers
                listContainer.innerHTML = '';
                gridContainer.innerHTML = '';

                // Display results
                displaySongs(songs);

                // Add loading indicator if more results available
                if (currentContinuation) {
                    addLoadingIndicator();
                } else {
                    hasMoreResults = false;
                    addEndMessage();
                }

            } catch (error) {
                console.error('Search error:', error);
                listContainer.innerHTML = '<div class="loading">Error loading songs. Please try again.</div>';
                gridContainer.innerHTML = '<div class="loading">Error loading songs. Please try again.</div>';
            }
        }

        // Display songs in list and grid
        function displaySongs(songs) {
            const listContainer = document.getElementById('songsList');
            const gridContainer = document.getElementById('songsGrid');

            // Remove existing loading indicators
            const existingIndicators = document.querySelectorAll('#loadingIndicator, .end-of-results');
            existingIndicators.forEach(ind => ind.remove());

            const currentIndex = currentPlaylist.length - songs.length;

            // Add songs to view
            songs.forEach((song, index) => {
                const globalIndex = currentIndex + index;

                // Add to list view
                const listItem = createSongListItem(song, globalIndex);
                listContainer.appendChild(listItem);

                // Add to grid view
                const card = createSongCard(song, globalIndex);
                gridContainer.appendChild(card);
            });

            console.log(`Displayed ${songs.length} songs. Total in playlist: ${currentPlaylist.length}`);
        }

        // Add loading indicator
        function addLoadingIndicator() {
            const listContainer = document.getElementById('songsList');
            const gridContainer = document.getElementById('songsGrid');

            // Remove old indicators first
            const oldIndicators = document.querySelectorAll('#loadingIndicator, .end-of-results');
            oldIndicators.forEach(ind => ind.remove());

            const loadingDivList = document.createElement('div');
            loadingDivList.id = 'loadingIndicator';
            loadingDivList.className = 'loading-spinner';
            loadingDivList.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scroll for more...';
            loadingDivList.style.display = 'none';

            const loadingDivGrid = document.createElement('div');
            loadingDivGrid.id = 'loadingIndicator';
            loadingDivGrid.className = 'loading-spinner';
            loadingDivGrid.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scroll for more...';
            loadingDivGrid.style.display = 'none';

            listContainer.appendChild(loadingDivList);
            gridContainer.appendChild(loadingDivGrid);
        }

        // Add end message
        function addEndMessage() {
            const listContainer = document.getElementById('songsList');
            const gridContainer = document.getElementById('songsGrid');

            // Remove old indicators first
            const oldIndicators = document.querySelectorAll('#loadingIndicator, .end-of-results');
            oldIndicators.forEach(ind => ind.remove());

            const endDivList = document.createElement('div');
            endDivList.className = 'end-of-results';
            endDivList.innerHTML = '<i class="fas fa-check-circle"></i> All results loaded';

            const endDivGrid = document.createElement('div');
            endDivGrid.className = 'end-of-results';
            endDivGrid.innerHTML = '<i class="fas fa-check-circle"></i> All results loaded';

            listContainer.appendChild(endDivList);
            gridContainer.appendChild(endDivGrid);
        }

        // Load more songs when scrolling
        async function loadMoreSongs() {
            if (isLoadingMore || !hasMoreResults || !currentContinuation || !currentSearchQuery) {
                return;
            }

            console.log('Loading more songs...', {
                currentPlaylist: currentPlaylist.length,
                hasContinuation: !!currentContinuation
            });

            isLoadingMore = true;

            // Show loading indicator
            const indicators = document.querySelectorAll('#loadingIndicator');
            indicators.forEach(indicator => {
                indicator.style.display = 'block';
                indicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading more...';
            });

            try {
                // Fetch next page using continuation token
                const response = await fetch(
                    `${API_BASE}/music/search?query=${encodeURIComponent(currentSearchQuery)}&limit=${SONGS_PER_PAGE}&continuation=${encodeURIComponent(currentContinuation)}`
                );
                const data = await response.json();

                const newSongs = data.results || data;
                currentContinuation = data.continuation || null;

                // Add to playlist
                currentPlaylist = currentPlaylist.concat(newSongs);

                // Display new songs
                displaySongs(newSongs);

                console.log('Loaded more songs:', {
                    newSongsCount: newSongs.length,
                    totalNow: currentPlaylist.length,
                    hasMore: !!currentContinuation
                });

                // Update state
                if (currentContinuation) {
                    addLoadingIndicator();
                } else {
                    hasMoreResults = false;
                    addEndMessage();
                }

            } catch (error) {
                console.error('Error loading more songs:', error);
                indicators.forEach(indicator => {
                    indicator.innerHTML = '<i class="fas fa-exclamation-circle"></i> Error loading more';
                });
            } finally {
                isLoadingMore = false;
            }
        }

        // Create Song List Item
        function createSongListItem(song, index) {
            const item = document.createElement('div');
            item.className = 'song-item';
            item.innerHTML = `
                <img src="${song.thumbnail || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'}" alt="${song.title}" />
                <div class="song-item-info">
                    <div class="song-item-title">${song.title}</div>
                    <div class="song-item-artist">${song.artist}${song.album ? '  ' + song.album : ''}</div>
                </div>
                <span class="song-item-duration">${formatDuration(song.duration)}</span>
                <button class="song-item-play" onclick='playSongByIndex(${index})'><i class="fas fa-play"></i></button>
            `;
            return item;
        }

        // Create Song Card
        function createSongCard(song, index) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${song.thumbnail || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'}" alt="${song.title}" />
                <h3>${song.title}</h3>
                <p>${song.artist}</p>
                ${song.album ? `<p>${song.album}</p>` : ''}
                <p>${formatDuration(song.duration)}</p>
                <div class="card-actions">
                    <button class="btn btn-primary" onclick='playSongByIndex(${index})'><i class="fas fa-play"></i> Play</button>
                    ${token ? `<button class="btn" onclick='addToPlaylist("${song.video_id}")'><i class="fas fa-plus"></i> Add to Playlist</button>` : ''}
                </div>
            `;
            return card;
        }

        // Play Song by Index
        function playSongByIndex(index) {
            currentSongIndex = index;
            playSong(currentPlaylist[index]);
        }

        // Play Song with instant feedback
        async function playSong(song) {
            try {
                const audio = document.getElementById('audioPlayer');

                // Show loading state immediately
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

                // Update UI immediately for instant feedback
                document.getElementById('currentSongTitle').textContent = song.title;
                document.getElementById('currentSongArtist').textContent = song.artist;
                document.getElementById('albumArt').src = song.thumbnail || 'https://via.placeholder.com/120';
                document.getElementById('albumDisk').classList.add('playing');

                // Reset progress bars
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('bufferedBar').style.width = '0%';
                document.getElementById('currentTime').textContent = '0:00';

                // Store current video ID and enable expand button
                currentVideoId = song.video_id;
                document.getElementById('musicPlayer').classList.add('has-song');

                // Load and play audio (proxy endpoint to avoid IP-locked 403 errors)
                audio.src = `${API_BASE}/music/stream/proxy/${song.video_id}`;
                audio.load(); // Force load to start buffering immediately

                // Play as soon as possible
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i>';
                        isPlaying = true;
                    }).catch(error => {
                        console.error('Playback error:', error);
                        document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i>';
                        isPlaying = false;
                    });
                }

                // Load video details in background (if player is expanded)
                if (isPlayerExpanded) {
                    setTimeout(() => loadVideoDetails(song.video_id), 500);
                }
            } catch (error) {
                console.error('Error playing song:', error);
                alert('Error playing song. Please try again.');
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
            }
        }

        // Toggle Play/Pause
        function togglePlay() {
            const audio = document.getElementById('audioPlayer');
            const btn = document.getElementById('playPauseBtn');
            const disk = document.getElementById('albumDisk');

            if (!audio.src) return;

            if (isPlaying) {
                audio.pause();
                btn.innerHTML = '<i class="fas fa-play"></i>';
                disk.classList.remove('playing');
                isPlaying = false;
            } else {
                audio.play();
                btn.innerHTML = '<i class="fas fa-pause"></i>';
                disk.classList.add('playing');
                isPlaying = true;
            }
        }

        // Stop Song
        function stopSong() {
            const audio = document.getElementById('audioPlayer');
            audio.pause();
            audio.currentTime = 0;
            document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i>';
            document.getElementById('albumDisk').classList.remove('playing');
            isPlaying = false;
        }

        // Next/Previous Song
        function nextSong() {
            if (currentPlaylist.length === 0) return;

            if (isShuffle) {
                currentSongIndex = Math.floor(Math.random() * currentPlaylist.length);
            } else {
                currentSongIndex = (currentSongIndex + 1) % currentPlaylist.length;
            }
            playSong(currentPlaylist[currentSongIndex]);
        }

        function previousSong() {
            if (currentPlaylist.length === 0) return;
            currentSongIndex = currentSongIndex - 1;
            if (currentSongIndex < 0) currentSongIndex = currentPlaylist.length - 1;
            playSong(currentPlaylist[currentSongIndex]);
        }

        // Shuffle
        function toggleShuffle() {
            isShuffle = !isShuffle;
            document.getElementById('shuffleBtn').style.opacity = isShuffle ? '1' : '0.5';
        }

        // Progress Bar with Buffering Indicator
        const audio = document.getElementById('audioPlayer');

        // Update playback progress
        audio.addEventListener('timeupdate', () => {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                document.getElementById('progressBar').style.width = percent + '%';
                document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
                document.getElementById('duration').textContent = formatTime(audio.duration);
            }

            // Also update buffered progress on timeupdate (more reliable)
            updateBufferedProgress();
        });

        // Update buffered progress (shows loaded portion)
        function updateBufferedProgress() {
            try {
                if (audio.duration && audio.buffered.length > 0) {
                    // Find the buffered range that contains current playback position
                    let bufferedEnd = 0;
                    for (let i = 0; i < audio.buffered.length; i++) {
                        const start = audio.buffered.start(i);
                        const end = audio.buffered.end(i);

                        // Use the furthest buffered end
                        if (end > bufferedEnd) {
                            bufferedEnd = end;
                        }
                    }

                    const bufferedPercent = Math.min(100, (bufferedEnd / audio.duration) * 100);
                    document.getElementById('bufferedBar').style.width = bufferedPercent + '%';

                    // Debug log (remove in production)
                    if (bufferedPercent > 0) {
                        console.log(`Buffered: ${bufferedPercent.toFixed(1)}%`);
                    }
                }
            } catch (e) {
                // Ignore buffering errors
            }
        }

        audio.addEventListener('progress', updateBufferedProgress);
        audio.addEventListener('loadedmetadata', updateBufferedProgress);
        audio.addEventListener('canplay', updateBufferedProgress);

        // Show loading state (buffering)
        audio.addEventListener('waiting', () => {
            document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            console.log('Buffering...');
        });

        // Hide loading state when ready
        audio.addEventListener('canplay', () => {
            if (isPlaying) {
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i>';
            }
            console.log('Can play');
        });

        // Auto-play when enough data is loaded
        audio.addEventListener('canplaythrough', () => {
            console.log('Can play through - fully buffered');
            updateBufferedProgress();
        });

        // Track loading progress
        audio.addEventListener('loadstart', () => {
            console.log('Loading started');
            document.getElementById('bufferedBar').style.width = '0%';
        });

        audio.addEventListener('loadeddata', () => {
            console.log('First frame loaded');
            updateBufferedProgress();
        });

        audio.addEventListener('stalled', () => {
            console.log('Download stalled');
        });

        audio.addEventListener('suspend', () => {
            console.log('Download suspended');
            updateBufferedProgress();
        });

        audio.addEventListener('ended', () => {
            nextSong();
        });

        // Improved seeking with visual feedback (Desktop + Mobile)
        function seekTo(event) {
            event.preventDefault(); // Prevent default touch behavior

            const bar = event.currentTarget || document.querySelector('.progress-bar');
            const rect = bar.getBoundingClientRect();

            // Support both mouse and touch events
            const clientX = event.clientX || (event.touches && event.touches[0].clientX) ||
                           (event.changedTouches && event.changedTouches[0].clientX);

            if (!clientX) return;

            const percent = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
            const newTime = percent * audio.duration;

            if (!isNaN(newTime) && isFinite(newTime) && audio.duration > 0) {
                audio.currentTime = newTime;
                // Update progress bar immediately for instant feedback
                document.getElementById('progressBar').style.width = (percent * 100) + '%';
                console.log(`Seeked to ${formatTime(newTime)} (${(percent * 100).toFixed(1)}%)`);
            }
        }

        // Add drag support for seeking (Desktop + Mobile)
        let isDragging = false;
        const progressBar = document.querySelector('.progress-bar');

        // Desktop - Mouse events
        progressBar.addEventListener('mousedown', (e) => {
            isDragging = true;
            seekTo(e);
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                seekTo(e);
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        // Mobile - Touch events
        progressBar.addEventListener('touchstart', (e) => {
            isDragging = true;
            seekTo(e);
        }, { passive: false });

        progressBar.addEventListener('touchmove', (e) => {
            if (isDragging) {
                seekTo(e);
            }
        }, { passive: false });

        progressBar.addEventListener('touchend', () => {
            isDragging = false;
        });

        progressBar.addEventListener('touchcancel', () => {
            isDragging = false;
        });

        // Format Time
        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function formatDuration(seconds) {
            if (!seconds) return '--:--';
            return formatTime(seconds);
        }

        // Authentication
        function checkAuth() {
            if (token) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('userInfo').style.display = 'block';
                loadUserInfo();
            } else {
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('userInfo').style.display = 'none';
            }
        }

        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }

            const formData = new FormData();
            formData.append('username', username);
            formData.append('password', password);

            try {
                const response = await fetch(`${API_BASE}/user/login`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    token = data.access_token;
                    localStorage.setItem('token', token);
                    checkAuth();
                } else {
                    alert('Login failed. Please check your credentials.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login error. Please try again.');
            }
        }

        function logout() {
            token = null;
            localStorage.removeItem('token');
            checkAuth();
        }

        async function loadUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/user/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to load user info');
                }

                const user = await response.json();
                document.getElementById('userUsername').textContent = user.username;
                document.getElementById('userEmail').textContent = user.email;
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        function showSignup() {
            alert('Signup feature coming soon! Please contact admin for account creation.');
        }

        // Playlists
        function showCreatePlaylistModal() {
            if (!token) {
                alert('Please login to create playlists');
                return;
            }
            document.getElementById('createPlaylistModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('createPlaylistModal').classList.remove('active');
        }

        async function createPlaylist() {
            const name = document.getElementById('playlistName').value;
            const description = document.getElementById('playlistDescription').value;

            if (!name) {
                alert('Please enter a playlist name');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/playlist/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ name, description })
                });

                if (response.ok) {
                    document.getElementById('playlistName').value = '';
                    document.getElementById('playlistDescription').value = '';
                    closeModal();
                    loadPlaylists();
                } else {
                    alert('Failed to create playlist');
                }
            } catch (error) {
                console.error('Error creating playlist:', error);
                alert('Error creating playlist');
            }
        }

        async function loadPlaylists() {
            if (!token) {
                document.getElementById('playlistsGrid').innerHTML = '<div class="loading">Please login to view playlists</div>';
                return;
            }

            document.getElementById('playlistsGrid').innerHTML = '<div class="loading">Loading playlists...</div>';

            try {
                const response = await fetch(`${API_BASE}/playlist/my-playlists`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to load playlists');
                }

                const playlists = await response.json();

                const grid = document.getElementById('playlistsGrid');
                grid.innerHTML = '';

                if (playlists.length === 0) {
                    grid.innerHTML = '<div class="loading">No playlists yet. Create one to get started!</div>';
                    return;
                }

                playlists.forEach(playlist => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <h3>${playlist.name}</h3>
                        <p>${playlist.description || 'No description'}</p>
                        <p><strong>Songs:</strong> ${playlist.songs.length}</p>
                        <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 8px;">
                            Created: ${new Date(playlist.created_at).toLocaleDateString()}
                        </p>
                    `;
                    grid.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading playlists:', error);
                document.getElementById('playlistsGrid').innerHTML = '<div class="loading">Error loading playlists</div>';
            }
        }

        async function loadHistory() {
            if (!token) {
                document.getElementById('historyList').innerHTML = '<div class="loading">Please login to view history</div>';
                return;
            }

            document.getElementById('historyList').innerHTML = '<div class="loading">Loading history...</div>';

            try {
                const response = await fetch(`${API_BASE}/user/history`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to load history');
                }

                const history = await response.json();

                const list = document.getElementById('historyList');

                if (history.length === 0) {
                    list.innerHTML = '<div class="loading">No listening history yet</div>';
                    return;
                }

                list.innerHTML = '<div class="songs-list active"></div>';
                const container = list.querySelector('.songs-list');

                for (const item of history.slice(0, 50)) {
                    try {
                        const songResponse = await fetch(`${API_BASE}/music/song/${item.video_id}`);
                        if (!songResponse.ok) continue;

                        const song = await songResponse.json();

                        const listItem = document.createElement('div');
                        listItem.className = 'song-item';
                        listItem.innerHTML = `
                            <img src="${song.thumbnail || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'}" alt="${song.title}" />
                            <div class="song-item-info">
                                <div class="song-item-title">${song.title}</div>
                                <div class="song-item-artist">${song.artist}  ${new Date(item.played_at).toLocaleString()}</div>
                            </div>
                            <span class="song-item-duration">${formatDuration(song.duration)}</span>
                            <button class="song-item-play" onclick='playSong(${JSON.stringify(song).replace(/'/g, "\\'")})'><i class="fas fa-play"></i></button>
                        `;
                        container.appendChild(listItem);
                    } catch (err) {
                        console.error('Error loading history item:', err);
                    }
                }
            } catch (error) {
                console.error('Error loading history:', error);
                document.getElementById('historyList').innerHTML = '<div class="loading">Error loading history</div>';
            }
        }

        // Search on Enter
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchSongs();
        });

        // Infinite Scroll - Detect when user scrolls near bottom
        const container = document.querySelector('.container');
        let scrollTimeout;

        container.addEventListener('scroll', () => {
            // Debounce scroll event
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const scrollTop = container.scrollTop;
                const scrollHeight = container.scrollHeight;
                const clientHeight = container.clientHeight;

                // Load more when user is 300px from bottom
                if (scrollHeight - scrollTop - clientHeight < 300) {
                    loadMoreSongs();
                }
            }, 100);
        });

        // ============================================================================
        // Video Details Panel Functions
        // ============================================================================

        /**
         * Toggle player expand/collapse
         */
        function togglePlayerExpand() {
            const player = document.getElementById('musicPlayer');
            isPlayerExpanded = !isPlayerExpanded;

            if (isPlayerExpanded) {
                player.classList.add('expanded');
                // Load video details if not already loaded
                if (currentVideoId) {
                    loadVideoDetails(currentVideoId);
                }
            } else {
                player.classList.remove('expanded');
            }
        }

        /**
         * Load video details and comments
         */
        async function loadVideoDetails(videoId) {
            const contentDiv = document.getElementById('videoDetailsContent');

            // Show loading state
            contentDiv.innerHTML = `
                <div class="loading-spinner">
                    <i class="fas fa-spinner"></i>
                    <p>Loading video details...</p>
                </div>
            `;

            try {
                // Fetch video details and comments in one call
                const response = await fetch(`${API_BASE}/youtube/video/${videoId}/full-details?include_comments=true&max_comments=20`);

                if (!response.ok) {
                    throw new Error('Failed to fetch video details');
                }

                const data = await response.json();

                // Render video details
                renderVideoDetails(data.video, data.comments);

            } catch (error) {
                console.error('Error loading video details:', error);
                contentDiv.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Failed to load video details. Please check your YouTube API configuration.</p>
                    </div>
                `;
            }
        }

        /**
         * Render video details and comments
         */
        function renderVideoDetails(video, commentsData) {
            const contentDiv = document.getElementById('videoDetailsContent');

            // Format numbers
            const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            };

            // Format date
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            };

            // Build HTML
            let html = `
                <!-- Video Information -->
                <div class="details-section">
                    <h3><i class="fas fa-info-circle"></i> Video Information</h3>
                    <div class="video-stats">
                        <div class="stat-item">
                            <i class="fas fa-eye"></i>
                            <span>${formatNumber(video.view_count)} views</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-thumbs-up"></i>
                            <span>${formatNumber(video.like_count)} likes</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-comment"></i>
                            <span>${formatNumber(video.comment_count)} comments</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-calendar"></i>
                            <span>${formatDate(video.published_at)}</span>
                        </div>
                    </div>
                    ${video.description ? `
                        <h4 style="margin-top: 15px; margin-bottom: 10px; font-size: 1rem;">Description</h4>
                        <div class="video-description">${escapeHtml(video.description)}</div>
                    ` : ''}
                </div>
            `;

            // Add comments section
            if (commentsData && commentsData.comments && commentsData.comments.length > 0) {
                html += `
                    <div class="details-section">
                        <h3><i class="fas fa-comments"></i> Comments (${commentsData.total_results})</h3>
                        <div class="comments-container">
                `;

                commentsData.comments.forEach(comment => {
                    html += renderComment(comment, formatDate);
                });

                html += `
                        </div>
                    </div>
                `;
            } else if (commentsData && commentsData.disabled) {
                html += `
                    <div class="details-section">
                        <h3><i class="fas fa-comments"></i> Comments</h3>
                        <p style="text-align: center; padding: 20px; opacity: 0.7;">
                            <i class="fas fa-ban"></i> Comments are disabled for this video
                        </p>
                    </div>
                `;
            }

            contentDiv.innerHTML = html;
        }

        /**
         * Render a single comment with replies
         */
        function renderComment(comment, formatDate) {
            let html = `
                <div class="comment">
                    <div class="comment-header">
                        <img src="${comment.author_profile_image || 'https://via.placeholder.com/40'}"
                             alt="${escapeHtml(comment.author)}"
                             class="comment-avatar">
                        <span class="comment-author">${escapeHtml(comment.author)}</span>
                        <span class="comment-date">${formatDate(comment.published_at)}</span>
                    </div>
                    <div class="comment-text">${escapeHtml(comment.text)}</div>
                    <div class="comment-footer">
                        <div class="comment-likes">
                            <i class="fas fa-thumbs-up"></i>
                            <span>${comment.like_count}</span>
                        </div>
                        ${comment.reply_count > 0 ? `
                            <span><i class="fas fa-reply"></i> ${comment.reply_count} ${comment.reply_count === 1 ? 'reply' : 'replies'}</span>
                        ` : ''}
                    </div>
            `;

            // Add replies if available
            if (comment.replies && comment.replies.length > 0) {
                html += '<div class="comment-replies">';
                comment.replies.forEach(reply => {
                    html += `
                        <div class="comment-reply">
                            <div class="comment-header">
                                <img src="${reply.author_profile_image || 'https://via.placeholder.com/40'}"
                                     alt="${escapeHtml(reply.author)}"
                                     class="comment-avatar"
                                     style="width: 32px; height: 32px;">
                                <span class="comment-author">${escapeHtml(reply.author)}</span>
                                <span class="comment-date">${formatDate(reply.published_at)}</span>
                            </div>
                            <div class="comment-text">${escapeHtml(reply.text)}</div>
                            <div class="comment-footer">
                                <div class="comment-likes">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span>${reply.like_count}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        /**
         * Escape HTML to prevent XSS
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Settings Dialog Functions
        function openSettingsDialog() {
            const overlay = document.getElementById('settingsDialog');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scroll
        }

        function closeSettingsDialog() {
            const overlay = document.getElementById('settingsDialog');
            overlay.classList.remove('active');
            document.body.style.overflow = ''; // Restore scroll
        }

        // Close dialog when clicking overlay
        document.addEventListener('click', (e) => {
            const overlay = document.getElementById('settingsDialog');
            if (e.target === overlay) {
                closeSettingsDialog();
            }
        });

        // Close dialog with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSettingsDialog();
            }
        });

        // Initialize
        checkAuth();
    </script>

    <!-- Settings Dialog -->
    <div id="settingsDialog" class="dialog-overlay">
        <div class="dialog">
            <div class="dialog-header">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                <button class="dialog-close" onclick="closeSettingsDialog()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="dialog-body">
                <!-- View Mode Section -->
                <div class="settings-section">
                    <h3>Display Preferences</h3>
                    <div class="settings-option">
                        <div class="settings-option-label">
                            <i class="fas fa-eye"></i>
                            View Mode
                        </div>
                        <div class="settings-option-description">
                            Choose how you want to view your music library
                        </div>
                        <div class="view-toggle">
                            <button class="view-btn active" onclick="setView('list')">
                                <i class="fas fa-list"></i> List View
                            </button>
                            <button class="view-btn" onclick="setView('grid')">
                                <i class="fas fa-th"></i> Grid View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>